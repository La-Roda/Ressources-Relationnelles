pipeline {
    agent any
    tools {nodejs "Node"}
    stages {

        stage('Test back') {
            steps {
                //sh 'jest'
                echo 'test'
            }
        }
        stage('test front') {
            steps {
                echo 'Testing..'
                dir('ressources-relationnelles/view/') { // Changer vers le répertoire souhaité
                    sh 'npm install'
                    sh 'jest' // Installer les dépendances front-end si nécessaire
                    echo 'test2'
                }
            }
        }
        stage('Build & Deploy') {
            steps {
                dir('ressources-relationnelles/view/') { // Changer vers le répertoire souhaité
                    sh 'npm install' // Installer les dépendances front-end si nécessaire
                    sh 'npm run build' // Builder la partie front de votre projet
                }
                dir('ressources-relationnelles/view/dist') {
                    ftpPublisher(
                        alwaysPublishFromMaster: false,
                        continueOnError: false,
                        failOnError: false,
                        masterNodeName: '', // Add the masterNodeName parameter with a valid value
                        paramPublish: [ parameterName: "" ], // Add the paramPublish parameter with a valid value
                        publishers: [
                            [
                                configName: 'Serveur front',
                                transfers: [
                                    [
                                        asciiMode: false,
                                        cleanRemote: true,
                                        excludes: '',
                                        flatten: false,
                                        makeEmptyDirs: false,
                                        noDefaultExcludes: false,
                                        patternSeparator: '[, ]+',
                                        remoteDirectory: '',
                                        remoteDirectorySDF: false,
                                        removePrefix: '',
                                        sourceFiles: '**/*.*'
                                    ]
                                ],
                                usePromotionTimestamp: false,
                                useWorkspaceInPromotion: false,
                                verbose: false
                            ]
                        ]
                    )

                }
            } 
        }
    }
}